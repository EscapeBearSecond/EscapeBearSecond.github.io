+++
title= "MySQL数据库事务"
subtitle= ""
date= 2024-06-04T14:46:52+08:00
lastmod= 2024-06-04T14:46:52+08:00
toc.enable= true
weight= false
categories= ["数据库"]
tags= ["数据库", "MySQL"]

+++

### 什么是事务

事务是数据库管理系统执行过程中的一个逻辑单元，由一个有限的数据库操作序列构成。这些操作要么全部执行，要么全部不执行，是一个不可分割的工作单位。事务由事务开始和事务结束之间的全部数据库操作组成。

### 事务的特性

事务具有四个特性ACID，分别是atomicity原子性、consistency一致性、isolation隔离性、durability一致性

> 原子性

一个事务必须被事务一个不可分割的最小单元，整个事务的所有操作要么全部成功，要么全部失败。对于一个事务来说不能只执行其中一部分操作。

> 一致性

一致性是指事务必须使数据库从一种一致状态转换到另一种一致状态。在事务开始之前和事务结束之后，数据库的完整性没有被破坏。

完整性主要包括：实体完整性、域完整性、参照完整性

> 隔离性

一个事务执行不能被其他事务干扰，即一个事务内部的操作及使用的数据对于其他事务来说是隔离的，并发执行的各个事务之间不能互相干扰。

> 持久性

一旦事务提交，则其所做的修改就会被永久保存到数据库中，即使系统崩溃，已经提交的数据也不会丢失。

### 并发事务的问题

我们知道MySQL是一个客户端／服务器架构的软件，对于同一个服务器来说，可以有若干个客户端与之连接，每个客户端与服务器连接上之后，就可以称之为一个会话（Session）。每个客户端都可以在自己的会话中向服务器发出请求语句，一个请求语句可能是某个事务的一部分，也就是对于服务器来说可能同时处理多个事务。

在上面我们说过事务有一个称之为隔离性的特性，理论上在某个事务对某个数据进行访问时，其他事务应该进行排队，当该事务提交之后，其他事务才可以继续访问这个数据，这样的话并发事务的执行就变成了串行化执行。

但是对串行化执行性能影响太大，我们既想保持事务的一定的隔离性，又想让服务器在处理访问同一数据的多个事务时性能尽量高些，当我们舍弃隔离性的时候，可能会带来什么样的数据问题呢？

#### 脏读

当一个事务读取到了另一个事务修改但未提交的数据，被称为脏读。

![05e67865973a410e93190c52a74be697](https://gitee.com/escapebear/blogpic/raw/master/img/202406041538418.png)

1. 事务A在执行过程中，对数据资源进行了修改
2. 事务B在A执行修改后读取了数据
3. 由于某些原因A并没有提交事务，而是发生了回滚，则之前的修改应是无效的，但是B已经读取了数据，就是脏数据。

#### 不可重复读

当事务内相同的记录被检索了两次或多次，但是却得到不同的结果时，被称为不可重复读。

![3895ad68683747e88b114bba40f48ad9](https://gitee.com/escapebear/blogpic/raw/master/img/202406041541002.png)







### MVCC

